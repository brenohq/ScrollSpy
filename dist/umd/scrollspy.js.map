{"version":3,"file":"scrollspy.js","sources":["../../src/scrollspy.js"],"sourcesContent":["/*\n * Copyright (c) 2016, Globo.com (https://github.com/globocom)\n *\n * License: MIT\n */\n\nvar instance = null;\nvar bind = function(fn, me) {\n  return function() {\n    return fn.apply(me, arguments);\n  };\n};\n\nfunction ScrollSpy() {\n  if (instance) {\n    return instance;\n  } else {\n    instance = {\n      add: bind(this.addElement, this),\n      clean: bind(this.cleanItems, this),\n      getItems: bind(this.getItems, this),\n      debug: bind(this.debug, this)\n    };\n  }\n  this.onScroll = bind(this.onScroll, this);\n  this.onResize = bind(this.onResize, this);\n  this.itemsLen = 0;\n  this.items = [];\n  this.setDefaultVariables();\n\n  return instance;\n}\n\nScrollSpy.prototype.throttle = function(callback) {\n  var idle = true;\n  return function() {\n    if (idle) {\n      callback();\n      idle = false;\n      setTimeout(function() {\n        return (idle = true);\n      }, 150);\n    }\n  };\n};\n\nScrollSpy.prototype.cleanItems = function() {\n  this.items = [];\n};\n\nScrollSpy.prototype.startListener = function() {\n  window.addEventListener(\"scroll\", this.throttle(this.onScroll));\n  window.addEventListener(\"resize\", this.throttle(this.onResize));\n};\n\nScrollSpy.prototype.stopListeners = function() {\n  window.removeEventListener(\"scroll\", this.throttle(this.onScroll));\n  window.removeEventListener(\"resize\", this.throttle(this.onResize));\n};\n\nScrollSpy.prototype.resetElementPosition = function() {\n  var item;\n  this.winHeight = window.innerHeight;\n  for (var i = 0, len = this.items.length; i < len; i++) {\n    item = this.items[i];\n    item.pos = this.getElementPos(item);\n  }\n  this.checkVisibleItems();\n};\n\nScrollSpy.prototype.getElementPos = function(param) {\n  var top = this.getScrollY();\n  var boundClient = param.el.getBoundingClientRect();\n  return boundClient[param.reference] + top - param.offset;\n};\n\nScrollSpy.prototype.getScrollY = function() {\n  var doc;\n  if (typeof pageYOffset !== \"undefined\") {\n    return pageYOffset;\n  } else {\n    doc = document.documentElement;\n    doc = doc.clientHeight ? doc : document.body;\n    return doc.scrollTop;\n  }\n};\n\nScrollSpy.prototype.onResize = function() {\n  this.throttle(function() {\n    if (this.winHeight !== window.innerHeight) {\n      this.resetElementPosition();\n    }\n  });\n};\n\nScrollSpy.prototype.onScroll = function() {\n  this.checkDocumentHeight();\n  this.checkVisibleItems();\n};\n\nScrollSpy.prototype.getItems = function() {\n  return this.items;\n};\n\nScrollSpy.prototype.setDefaultVariables = function() {\n  this.winHeight = window.innerHeight;\n  this.lastPos = this.getScrollY();\n  this.docHeight = document.body ? document.body.offsetHeight : 0;\n};\n\nScrollSpy.prototype.addElement = function(param) {\n  var count, item, prevItensLength;\n  if (!param.el) {\n    return;\n  }\n  param.offset = typeof param.offset === \"undefined\" ? 200 : param.offset;\n  param.reference = param.reference || \"top\";\n  param.pos = this.getElementPos(param);\n  prevItensLength = this.items.length;\n  count = 0;\n\n  for (var i = 0, len = this.items.length; i < len; i++) {\n    item = this.items[i];\n    if (item.pos > param.pos) {\n      break;\n    }\n    count++;\n  }\n  this.items.splice(count, 0, param);\n  this.itemsLen = this.items.length;\n  if (prevItensLength === 0) {\n    this.setDefaultVariables();\n    this.startListener();\n  }\n  this.checkVisibleItems();\n};\n\nScrollSpy.prototype.checkDocumentHeight = function() {\n  var currentDocHeight = document.body.offsetHeight;\n  if (this.docHeight !== currentDocHeight) {\n    this.docHeight = currentDocHeight;\n    this.resetElementPosition();\n  }\n};\n\nScrollSpy.prototype.checkVisibleItems = function() {\n  var item;\n  var currentPos = this.getScrollY();\n  var currentPosOffset = this.winHeight + currentPos;\n  while (this.items.length) {\n    item = this.items[0];\n    if (currentPosOffset >= item.pos) {\n      if (item.callback) {\n        item.callback();\n      }\n      this.items.shift();\n      this.itemsLen = this.items.length;\n    } else {\n      break;\n    }\n  }\n  this.lastPos = currentPos;\n  if (!this.items.length) {\n    this.stopListeners();\n  }\n};\n\nScrollSpy.prototype.debug = function() {\n  var nodeHtml, css, border, color, item;\n\n  for (var i = 0, len = this.items.length; i < len; i++) {\n    item = this.items[i];\n    color = i % 2 ? \"red\" : \"blue\";\n    border = \"2px dashed \" + color;\n    item.el.style[\"border\"] = border;\n\n    css = \"top: \" + item.pos + \";\";\n    css += \"width: 100%;\";\n    css += \"position: absolute;\";\n    css += \"border-top: \" + border + \";\";\n\n    nodeHtml = document.createElement(\"div\");\n    nodeHtml.className = \"debug-line\";\n    nodeHtml.setAttribute(\"style\", css);\n    document.body.appendChild(nodeHtml);\n  }\n};\n\nexport default new ScrollSpy();\n"],"names":[],"mappings":"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"}